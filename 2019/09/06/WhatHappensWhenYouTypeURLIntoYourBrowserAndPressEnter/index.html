<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>在浏览器输入 URL 回车之后发生了什么 | Blog | tao-lol</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="Web">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.4.4">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	false,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">濤</h5>
          <a href="mailto:tao-lol@qq.com" title="tao-lol@qq.com" class="mail">
            
              <span>t</span>
            
              <span>a</span>
            
              <span>o</span>
            
              <span>-</span>
            
              <span>l</span>
            
              <span>o</span>
            
              <span>l</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/Tao-lol" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>在浏览器输入 URL 回车之后发生了什么</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">在浏览器输入 URL 回车之后发生了什么</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-09-06T03:13:11.000Z" itemprop="datePublished" class="page-time">
  2019-09-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/">编程</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-WhatHappensWhenYouTypeURLIntoYourBrowserAndPressEnter"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">在浏览器输入 URL 回车之后发生了什么</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-09-06 11:13:11" datetime="2019-09-06T03:13:11.000Z"  itemprop="datePublished">2019-09-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/">编程</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <blockquote>
<p><a href="https://4ark.me/post/b6c7c0a2.html" target="_blank" rel="noopener">https://4ark.me/post/b6c7c0a2.html</a></p>
</blockquote>
<a id="more"></a>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;这个问题已经是老生常谈了，更是经常被作为面试的压轴题出现，网上也有很多文章，但最近闲的无聊，然后就自己做了一篇笔记，感觉比之前理解更透彻了。<br>&emsp;&emsp;这篇笔记是我这两天看了数十篇文章总结出来的，所以相对全面一点，但由于我是做前端的，所以会比较重点分析浏览器渲染页面那一部分，至于其他部分我会罗列出关键词，感兴趣的可以自行查阅  </p>
<p>&emsp;&emsp;<strong>注意</strong>：本文的步骤是建立在，请求的是一个简单的 HTTP 请求，没有 HTTPS、HTTP2、最简单的 DNS、没有代理、并且服务器没有任何问题的基础上，尽管这是不切实际的。  </p>
<h2 id="大致流程"><a href="#大致流程" class="headerlink" title="大致流程"></a>大致流程</h2><ol>
<li>URL 解析</li>
<li>DNS 查询</li>
<li>TCP 连接</li>
<li>处理请求</li>
<li>接受响应</li>
<li>渲染页面</li>
</ol>
<h1 id="一、URL-解析"><a href="#一、URL-解析" class="headerlink" title="一、URL 解析"></a>一、URL 解析</h1><h2 id="地址解析："><a href="#地址解析：" class="headerlink" title="地址解析："></a>地址解析：</h2><p>&emsp;&emsp;首先判断你输入的是一个合法的 URL 还是一个待搜索的关键词，并且根据你输入的内容进行自动完成、字符编码等操作。</p>
<h2 id="HSTS"><a href="#HSTS" class="headerlink" title="HSTS"></a>HSTS</h2><p>&emsp;&emsp;由于安全隐患，会使用 HSTS 强制客户端使用 HTTPS 访问页面。详见：<a href="https://www.barretlee.com/blog/2015/10/22/hsts-intro/" target="_blank" rel="noopener">你所不知道的 HSTS</a>。</p>
<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><p>&emsp;&emsp;浏览器还会进行一些额外的操作，比如安全检查、访问限制（之前国产浏览器限制 996.icu）。</p>
<h2 id="检查缓存"><a href="#检查缓存" class="headerlink" title="检查缓存"></a>检查缓存</h2><figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="检查缓存.png" title="" data-fancybox="images"><img src="检查缓存.png" alt title class></a>
                <p></p>
            </figure>

<h1 id="二、DNS-查询"><a href="#二、DNS-查询" class="headerlink" title="二、DNS 查询"></a>二、DNS 查询</h1><h2 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤"></a>基本步骤</h2><figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="DNS查询.png" title="" data-fancybox="images"><img src="DNS查询.png" alt title class></a>
                <p></p>
            </figure>
<h2 id="1-浏览器缓存"><a href="#1-浏览器缓存" class="headerlink" title="1. 浏览器缓存"></a>1. 浏览器缓存</h2><p>&emsp;&emsp;浏览器会先检查是否在缓存中，没有则调用系统库函数进行查询。</p>
<h2 id="2-操作系统缓存"><a href="#2-操作系统缓存" class="headerlink" title="2. 操作系统缓存"></a>2. 操作系统缓存</h2><p>&emsp;&emsp;操作系统也有自己的 DNS缓存，但在这之前，会向检查域名是否存在本地的 Hosts 文件里，没有则向 DNS 服务器发送查询请求。</p>
<h2 id="3-路由器缓存"><a href="#3-路由器缓存" class="headerlink" title="3. 路由器缓存"></a>3. 路由器缓存</h2><p>&emsp;&emsp;路由器也有自己的缓存。</p>
<h2 id="4-ISP-DNS-缓存"><a href="#4-ISP-DNS-缓存" class="headerlink" title="4. ISP DNS 缓存"></a>4. ISP DNS 缓存</h2><p>&emsp;&emsp;ISP DNS 就是在客户端电脑上设置的首选 DNS 服务器，它们在大多数情况下都会有缓存。</p>
<h2 id="根域名服务器查询"><a href="#根域名服务器查询" class="headerlink" title="根域名服务器查询"></a>根域名服务器查询</h2><p>&emsp;&emsp;在前面所有步骤没有缓存的情况下，本地 DNS 服务器会将请求转发到互联网上的根域，下面这个图很好的诠释了整个流程：</p>
<figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="DNS根域名服务器查询.png" title="" data-fancybox="images"><img src="DNS根域名服务器查询.png" alt title class></a>
                <p></p>
            </figure>

<blockquote>
<p>根域名服务器：<a href="https://zh.wikipedia.org/wiki/%E6%A0%B9%E7%B6%B2%E5%9F%9F%E5%90%8D%E7%A8%B1%E4%BC%BA%E6%9C%8D%E5%99%A8" target="_blank" rel="noopener">维基百科</a></p>
</blockquote>
<h2 id="需要注意的点"><a href="#需要注意的点" class="headerlink" title="需要注意的点"></a>需要注意的点</h2><ol>
<li>递归方式：一路查下去中间不返回，得到最终结果才返回信息（浏览器到本地DNS服务器的过程）</li>
<li>迭代方式，就是本地DNS服务器到根域名服务器查询的方式。</li>
<li>什么是 DNS 劫持</li>
<li>前端 dns-prefetch 优化</li>
</ol>
<h1 id="三、TCP-连接"><a href="#三、TCP-连接" class="headerlink" title="三、TCP 连接"></a>三、TCP 连接</h1><p>&emsp;&emsp;TCP/IP 分为四层，在发送数据时，每层都要对数据进行封装：<br><a rel=在浏览器输入 URL 回车之后发生了什么 href="TCP%E8%BF%9E%E6%8E%A5.png" title=" " data-fancybox="images"><img src="TCP%E8%BF%9E%E6%8E%A5.png" alt=" "></a></p>
<h2 id="1-应用层：发送-HTTP-请求"><a href="#1-应用层：发送-HTTP-请求" class="headerlink" title="1. 应用层：发送 HTTP 请求"></a>1. 应用层：发送 HTTP 请求</h2><p>&emsp;&emsp;在前面的步骤我们已经得到服务器的 IP 地址，浏览器会开始构造一个 HTTP 报文，其中包括：</p>
<ul>
<li>请求报头（Request Header）：请求方法、目标地址、遵循的协议等等</li>
<li>请求主体（其他参数）</li>
</ul>
<p>&emsp;&emsp;其中需要注意的点：</p>
<ul>
<li>浏览器只能发送 GET、POST 方法，而打开网页使用的是 GET 方法</li>
</ul>
<h2 id="2-传输层：TCP-传输报文"><a href="#2-传输层：TCP-传输报文" class="headerlink" title="2. 传输层：TCP 传输报文"></a>2. 传输层：TCP 传输报文</h2><p>&emsp;&emsp;传输层会发起一条到达服务器的 TCP 连接，为了方便传输，会对数据进行分割（以报文段为单位），并标记编号，方便服务器接受时能够准确地还原报文信息。<br>&emsp;&emsp;在建立连接前，会先进行 TCP 三次握手。</p>
<blockquote>
<p>关于 TCP/IP 三次握手，网上已经有很多段子和图片生动地描述了。<br>相关知识点：<br>&emsp;&emsp;SYN 泛洪攻击</p>
</blockquote>
<h2 id="3-网络层：IP协议查询Mac地址"><a href="#3-网络层：IP协议查询Mac地址" class="headerlink" title="3. 网络层：IP协议查询Mac地址"></a>3. 网络层：IP协议查询Mac地址</h2><p>&emsp;&emsp;将数据段打包，并加入源及目标的IP地址，并且负责寻找传输路线。<br>&emsp;&emsp;判断目标地址是否与当前地址处于同一网络中，是的话直接根据 Mac 地址发送，否则使用路由表查找下一跳地址，以及使用 ARP 协议查询它的 Mac 地址。</p>
<blockquote>
<p>注意：在 OSI 参考模型中 ARP 协议位于链路层，但在 TCP/IP 中，它位于网络层。</p>
</blockquote>
<h2 id="4-链路层：以太网协议"><a href="#4-链路层：以太网协议" class="headerlink" title="4. 链路层：以太网协议"></a>4. 链路层：以太网协议</h2><h3 id="以太网协议"><a href="#以太网协议" class="headerlink" title="以太网协议"></a>以太网协议</h3><p>&emsp;&emsp;根据以太网协议将数据分为以“帧”为单位的数据包，每一帧分为两个部分：</p>
<ul>
<li>标头：数据包的发送者、接受者、数据类型</li>
<li>数据：数据包具体内容</li>
</ul>
<h3 id="Mac-地址"><a href="#Mac-地址" class="headerlink" title="Mac 地址"></a>Mac 地址</h3><p>&emsp;&emsp;以太网规定了连入网络的所有设备都必须具备“网卡”接口，数据包都是从一块网卡传递到另一块网卡，网卡的地址就是 Mac 地址。每一个 Mac 地址都是独一无二的，具备了一对一的能力。</p>
<h3 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h3><p>&emsp;&emsp;发送数据的方法很原始，直接把数据通过 ARP 协议，向本网络的所有机器发送，接收方根据标头信息与自身 Mac 地址比较，一致就接受，否则丢弃。<br>&emsp;&emsp;<strong>注意</strong>：接收方回应是单播。</p>
<blockquote>
<p>相关知识点：<br>&emsp;&emsp;ARP 攻击</p>
</blockquote>
<h2 id="服务器接受请求"><a href="#服务器接受请求" class="headerlink" title="服务器接受请求"></a>服务器接受请求</h2><p>&emsp;&emsp;接受过程就是把以上步骤逆转过来，参见上图。</p>
<h1 id="四、服务器处理请求"><a href="#四、服务器处理请求" class="headerlink" title="四、服务器处理请求"></a>四、服务器处理请求</h1><h2 id="大致流程-1"><a href="#大致流程-1" class="headerlink" title="大致流程"></a>大致流程</h2><figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="服务器处理请求.png" title="" data-fancybox="images"><img src="服务器处理请求.png" alt title class></a>
                <p></p>
            </figure>
<h2 id="HTTPD"><a href="#HTTPD" class="headerlink" title="HTTPD"></a>HTTPD</h2><p>&emsp;&emsp;最常见的 HTTPD 有 Linux 上常用的 Apache 和 Nginx，以及 Windows 上的 IIS。<br>&emsp;&emsp;它会监听得到的请求，然后开启一个子进程去处理这个请求。</p>
<h2 id="处理请求"><a href="#处理请求" class="headerlink" title="处理请求"></a>处理请求</h2><p>&emsp;&emsp;接受 TCP 报文后，会对连接进行处理，对HTTP协议进行解析（请求方法、域名、路径等），并且进行一些验证：</p>
<ul>
<li>验证是否配置虚拟主机</li>
<li>验证虚拟主机是否接受此方法</li>
<li>验证该用户可以使用该方法（根据 IP 地址、身份信息等）</li>
</ul>
<h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><p>&emsp;&emsp;假如服务器配置了 HTTP 重定向，就会返回一个<code>301</code>永久重定向响应，浏览器就会根据响应，重新发送 HTTP 请求（重新执行上面的过程）。</p>
<blockquote>
<p>关于更多：<a href="https://www.cnblogs.com/workest/p/3891321.html" target="_blank" rel="noopener">详见这篇文章</a></p>
</blockquote>
<h2 id="URL-重写"><a href="#URL-重写" class="headerlink" title="URL 重写"></a>URL 重写</h2><p>&emsp;&emsp;然后会查看 URL 重写规则，如果请求的文件是真实存在的，比如图片、html、css、js文件等，则会直接把这个文件返回。<br>&emsp;&emsp;否则服务器会按照规则把请求重写到 一个 REST 风格的 URL 上。<br>&emsp;&emsp;然后根据动态语言的脚本，来决定调用什么类型的动态文件解释器来处理这个请求。<br>&emsp;&emsp;以 PHP 语言的 MVC 框架举例，它首先会初始化一些环境的参数，根据 URL 由上到下地去匹配路由，然后让路由所定义的方法去处理请求。</p>
<h1 id="五、浏览器接受响应"><a href="#五、浏览器接受响应" class="headerlink" title="五、浏览器接受响应"></a>五、浏览器接受响应</h1><p>&emsp;&emsp;浏览器接收到来自服务器的响应资源后，会对资源进行分析。<br>&emsp;&emsp;首先查看 Response header，根据不同状态码做不同的事（比如上面提到的重定向）。<br>&emsp;&emsp;如果响应资源进行了压缩（比如 gzip），还需要进行解压。<br>&emsp;&emsp;然后，对响应资源做缓存。<br>&emsp;&emsp;接下来，根据响应资源里的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener">MIME</a> 类型去解析响应内容（比如 HTML、Image各有不同的解析方式）。</p>
<h1 id="六、渲染页面"><a href="#六、渲染页面" class="headerlink" title="六、渲染页面"></a>六、渲染页面</h1><h3 id="浏览器内核"><a href="#浏览器内核" class="headerlink" title="浏览器内核"></a>浏览器内核</h3><figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="浏览器内核.png" title="" data-fancybox="images"><img src="浏览器内核.png" alt title class></a>
                <p></p>
            </figure>  
<p>&emsp;&emsp;不同的浏览器内核，渲染过程也不完全相同，但大致流程都差不多。</p>
<h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="渲染页面.png" title="" data-fancybox="images"><img src="渲染页面.png" alt title class></a>
                <p></p>
            </figure>
<h2 id="1-HTML-解析"><a href="#1-HTML-解析" class="headerlink" title="1. HTML 解析"></a>1. HTML 解析</h2><p>&emsp;&emsp;首先要知道浏览器解析是从上往下一行一行地解析的。  </p>
<p>解析的过程可以分为四个步骤：</p>
<h3 id="1-解码（encoding）"><a href="#1-解码（encoding）" class="headerlink" title="1. 解码（encoding）"></a>1. 解码（encoding）</h3><p>&emsp;&emsp;传输回来的其实都是一些二进制字节数据，浏览器需要根据文件指定编码（例如UTF-8）转换成字符串，也就是HTML 代码。</p>
<h3 id="2-预解析（pre-parsing）"><a href="#2-预解析（pre-parsing）" class="headerlink" title="2. 预解析（pre-parsing）"></a>2. 预解析（pre-parsing）</h3><p>&emsp;&emsp;预解析做的事情是提前加载资源，减少处理时间，它会识别一些会请求资源的属性，比如<code>img</code>标签的<code>src</code>属性，并将这个请求加到请求队列中。</p>
<h3 id="3-符号化（Tokenization）"><a href="#3-符号化（Tokenization）" class="headerlink" title="3. 符号化（Tokenization）"></a>3. 符号化（Tokenization）</h3><p>&emsp;&emsp;符号化是词法分析的过程，将输入解析成符号，HTML 符号包括，开始标签、结束标签、属性名和属性值。<br>它通过一个状态机去识别符号的状态，比如遇到<code>&lt;</code>，<code>&gt;</code>状态都会产生变化。</p>
<h3 id="4-构建树（tree-construction）"><a href="#4-构建树（tree-construction）" class="headerlink" title="4. 构建树（tree construction）"></a>4. 构建树（tree construction）</h3><blockquote>
<p>注意：符号化和构建树是并行操作的，也就是说只要解析到一个开始标签，就会创建一个 DOM 节点。</p>
</blockquote>
<p>&emsp;&emsp;在上一步符号化中，解析器获得这些标记，然后以合适的方法创建<code>DOM</code>对象并把这些符号插入到<code>DOM</code>对象中。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Web page parsing<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Web page parsing<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is an example Web page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="构建树.png" title="" data-fancybox="images"><img src="构建树.png" alt title class></a>
                <p></p>
            </figure>
<h3 id="浏览器容错进制"><a href="#浏览器容错进制" class="headerlink" title="浏览器容错进制"></a>浏览器容错进制</h3><p>&emsp;&emsp;你从来没有在浏览器看过类似”语法无效”的错误，这是因为浏览器去纠正错误的语法，然后继续工作。</p>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>&emsp;&emsp;当整个解析的过程完成以后，浏览器会通过<code>DOMContentLoaded</code>事件来通知<code>DOM</code>解析完成。</p>
<h2 id="2-CSS-解析"><a href="#2-CSS-解析" class="headerlink" title="2. CSS 解析"></a>2. CSS 解析</h2><p>&emsp;&emsp;一旦浏览器下载了 CSS，CSS 解析器就会处理它遇到的任何 CSS，根据<a href="https://drafts.csswg.org/css-syntax-3/" target="_blank" rel="noopener">语法规范</a>解析出所有的 CSS 并进行标记化，然后我们得到一个规则表。</p>
<h3 id="CSS-匹配规则"><a href="#CSS-匹配规则" class="headerlink" title="CSS 匹配规则"></a>CSS 匹配规则</h3><p>&emsp;&emsp;在匹配一个节点对应的 CSS 规则时，是按照从右到左的顺序的，例如：<code>div p { font-size :14px }</code>会先寻找所有的<code>p</code>标签然后判断它的父元素是否为<code>div</code>。<br>&emsp;&emsp;所以我们写 CSS 时，尽量用 id 和 class，千万不要过度层叠。</p>
<h2 id="3-渲染树"><a href="#3-渲染树" class="headerlink" title="3. 渲染树"></a>3. 渲染树</h2><p>&emsp;&emsp;其实这就是一个 DOM 树和 CSS 规则树合并的过程。</p>
<blockquote>
<p>注意：渲染树会忽略那些不需要渲染的节点，比如设置了<code>display:none</code>的节点。</p>
</blockquote>
<h3 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h3><p>&emsp;&emsp;通过计算让任何尺寸值都减少到三个可能之一：<code>auto</code>、百分比、px，比如把<code>rem</code>转化为<code>px</code>。</p>
<h3 id="级联"><a href="#级联" class="headerlink" title="级联"></a>级联</h3><p>&emsp;&emsp;浏览器需要一种方法来确定哪些样式才真正需要应用到对应元素，所以它使用一个叫做<code>specificity</code>的公式，这个公式会通过：</p>
<ol>
<li>标签名、class、id</li>
<li>是否内联样式</li>
<li><code>!important</code> </li>
</ol>
<p>&emsp;&emsp;然后得出一个权重值，取最高的那个。</p>
<h3 id="渲染阻塞"><a href="#渲染阻塞" class="headerlink" title="渲染阻塞"></a>渲染阻塞</h3><p>&emsp;&emsp;当遇到一个<code>script</code>标签时，DOM 构建会被暂停，直至脚本完成执行，然后继续构建 DOM 树。<br>&emsp;&emsp;但如果 JS 依赖 CSS 样式，而它还没有被下载和构建时，浏览器就会延迟脚本执行，直至 CSS Rules 被构建。  </p>
<p>&emsp;&emsp;所以我们知道：</p>
<ul>
<li>CSS 会阻塞 JS 执行</li>
<li>JS 会阻塞后面的 DOM 解析</li>
</ul>
<p>&emsp;&emsp;为了避免这种情况，应该以下原则：</p>
<ul>
<li>CSS 资源排在 JavaScript 资源前面</li>
<li>JS 放在 HTML 最底部，也就是 <code>&lt;/body&gt;</code>前</li>
</ul>
<p>&emsp;&emsp;另外，如果要改变阻塞模式，可以使用 defer 与 async，详见：<a href="https://github.com/xiaoyu2er/blog/issues/8" target="_blank" rel="noopener">这篇文章</a></p>
<h2 id="4-布局与绘制"><a href="#4-布局与绘制" class="headerlink" title="4. 布局与绘制"></a>4. 布局与绘制</h2><p>&emsp;&emsp;确定渲染树种所有节点的几何属性，比如：位置、大小等等，最后输入一个盒子模型，它能精准地捕获到每个元素在屏幕内的准确位置与大小。<br>&emsp;&emsp;然后遍历渲染树，调用渲染器的 paint() 方法在屏幕上显示其内容。</p>
<h2 id="5-合并渲染层"><a href="#5-合并渲染层" class="headerlink" title="5. 合并渲染层"></a>5. 合并渲染层</h2><p>&emsp;&emsp;把以上绘制的所有图片合并，最终输出一张图片。</p>
<h2 id="6-回流与重绘"><a href="#6-回流与重绘" class="headerlink" title="6. 回流与重绘"></a>6. 回流与重绘</h2><h3 id="回流-reflow"><a href="#回流-reflow" class="headerlink" title="回流(reflow)"></a>回流(reflow)</h3><p>&emsp;&emsp;当浏览器发现某个部分发现变化影响了布局时，需要倒回去重新渲染，会从html标签开始递归往下，重新计算位置和大小。<br>&emsp;&emsp;reflow基本是无法避免的，因为当你滑动一下鼠标、resize 窗口，页面就会产生变化。</p>
<h3 id="重绘-repaint"><a href="#重绘-repaint" class="headerlink" title="重绘(repaint)"></a>重绘(repaint)</h3><p>&emsp;&emsp;改变了某个元素的背景色、文字颜色等等不会影响周围元素的位置变化时，就会发生重绘。<br>&emsp;&emsp;每次重绘后，浏览器还需要合并渲染层并输出到屏幕上。<br>&emsp;&emsp;回流的成本要比重绘高很多，所以我们应该尽量避免产生回流。  </p>
<p>&emsp;&emsp;比如：</p>
<ul>
<li><code>display:none</code> 会触发回流，而 <code>visibility:hidden</code> 只会触发重绘。</li>
</ul>
<h2 id="7-JavaScript-编译执行"><a href="#7-JavaScript-编译执行" class="headerlink" title="7. JavaScript 编译执行"></a>7. JavaScript 编译执行</h2><h3 id="大致流程-2"><a href="#大致流程-2" class="headerlink" title="大致流程"></a>大致流程</h3><figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="JavaScript编译运行.png" title="" data-fancybox="images"><img src="JavaScript编译运行.png" alt title class></a>
                <p></p>
            </figure>  

<p>可以分为三个阶段：</p>
<h3 id="1-词法分析"><a href="#1-词法分析" class="headerlink" title="1. 词法分析"></a>1. 词法分析</h3><p>&emsp;&emsp;JS 脚本加载完毕后，会首先进入语法分析阶段，它首先会分析代码块的语法是否正确，不正确则抛出“语法错误”，停止执行。  </p>
<p>&emsp;&emsp;几个步骤：</p>
<ul>
<li>分词，例如将<code>var a = 2</code>，分成<code>var</code>、<code>a</code>、<code>=</code>、<code>2</code>这样的词法单元。</li>
<li>解析，将词法单元转换成抽象语法树（AST）。</li>
<li>代码生成，将抽象语法树转换成机器指令。</li>
</ul>
<h3 id="2-预编译"><a href="#2-预编译" class="headerlink" title="2. 预编译"></a>2. 预编译</h3><p>&emsp;&emsp;JS 有三种运行环境：</p>
<ul>
<li>全局环境</li>
<li>函数环境</li>
<li>eval</li>
</ul>
<p>&emsp;&emsp;每进入一个不同的运行环境都会创建一个对应的执行上下文，根据不同的上下文环境，形成一个函数调用栈，栈底永远是全局执行上下文，栈顶则永远是当前执行上下文。</p>
<h4 id="创建执行上下文"><a href="#创建执行上下文" class="headerlink" title="创建执行上下文"></a>创建执行上下文</h4><p>&emsp;&emsp;创建执行上下文的过程中，主要做了以下三件事：</p>
<ul>
<li>创建变量对象<ul>
<li>参数、函数、变量</li>
</ul>
</li>
<li>建立作用域链<ul>
<li>确认当前执行环境是否能访问变量</li>
</ul>
</li>
<li>确定 This 指向</li>
</ul>
<h3 id="3-执行"><a href="#3-执行" class="headerlink" title="3. 执行"></a>3. 执行</h3><h4 id="JS-线程"><a href="#JS-线程" class="headerlink" title="JS 线程"></a>JS 线程</h4><figure class="image-box">
                <a rel=在浏览器输入 URL 回车之后发生了什么 href="JS线程.png" title="" data-fancybox="images"><img src="JS线程.png" alt title class></a>
                <p></p>
            </figure>  
<p>&emsp;&emsp;虽然 JS 是单线程的，但实际上参与工作的线程一共有四个：</p>
<blockquote>
<p>其中三个只是协助，只有 JS 引擎线程是真正执行的</p>
</blockquote>
<ul>
<li>JS 引擎线程：也叫 JS 内核，负责解析执行 JS 脚本程序的主线程，例如 V8 引擎</li>
<li>事件触发线程：属于浏览器内核线程，主要用于控制事件，例如鼠标、键盘等，当事件被触发时，就会把事件的处理函数推进事件队列，等待 JS 引擎线程执行</li>
<li>定时器触发线程：主要控制<code>setInterval</code>和<code>setTimeout</code>，用来计时，计时完毕后，则把定时器的处理函数推进事件队列中，等待 JS 引擎线程。</li>
<li>HTTP 异步请求线程：通过XMLHttpRequest连接后，通过浏览器新开的一个线程，监控readyState状态变更时，如果设置了该状态的回调函数，则将该状态的处理函数推进事件队列中，等待JS引擎线程执行。</li>
</ul>
<p>&emsp;&emsp;<strong>注：浏览器对同一域名的并发连接数是有限的，通常为 6 个。</strong></p>
<h4 id="宏任务"><a href="#宏任务" class="headerlink" title="宏任务"></a>宏任务</h4><p>&emsp;&emsp;分为：</p>
<ul>
<li>同步任务：按照顺序执行，只有前一个任务完成后，才能执行后一个任务</li>
<li>异步任务：不直接执行，只有满足触发条件时，相关的线程将该异步任务推进任务队列中，等待JS引擎主线程上的任务执行完毕时才开始执行，例如异步Ajax、DOM事件，setTimeout等。</li>
</ul>
<h4 id="微任务"><a href="#微任务" class="headerlink" title="微任务"></a>微任务</h4><p>&emsp;&emsp;微任务是ES6和Node环境下的，主要 API 有：<code>Promise</code>，<code>process.nextTick</code>。<br>&emsp;&emsp;微任务的执行在宏任务的同步任务之后，在异步任务之前。<br><a rel=在浏览器输入 URL 回车之后发生了什么 href="%E5%BE%AE%E4%BB%BB%E5%8A%A1.png" title=" " data-fancybox="images"><img src="%E5%BE%AE%E4%BB%BB%E5%8A%A1.png" alt=" "></a>  </p>
<h4 id="代码例子"><a href="#代码例子" class="headerlink" title="代码例子"></a>代码例子</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'1'</span>); <span class="comment">// 宏任务 同步</span></span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2'</span>); <span class="comment">// 宏任务 异步</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'3'</span>); <span class="comment">// 宏任务 同步</span></span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'4'</span>) <span class="comment">// 微任务</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'5'</span>) <span class="comment">// 宏任务 同步</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;以上代码输出顺序为：1,3,5,4,2</p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul>
<li><a href="https://github.com/skyline75489/what-happens-when-zh_CN" target="_blank" rel="noopener">what-happens-when-zh_CN</a></li>
<li><a href="https://alistapart.com/article/tags-to-dom/" target="_blank" rel="noopener">Tags to DOM</a></li>
<li><a href="https://heyingye.github.io/2018/04/16/%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/" target="_blank" rel="noopener">彻底理解浏览器的缓存机制</a></li>
<li><a href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#The_rendering_engine" target="_blank" rel="noopener">浏览器的工作原理：新式网络浏览器幕后揭秘</a></li>
<li><a href="https://blog.fundebug.com/2019/01/03/understand-browser-rendering/" target="_blank" rel="noopener">深入浅出浏览器渲染原理</a></li>
<li><a href="https://heyingye.github.io/2018/03/19/js%E5%BC%95%E6%93%8E%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/#%E9%A2%84%E7%BC%96%E8%AF%91%E9%98%B6%E6%AE%B5" target="_blank" rel="noopener">js引擎的执行过程（一）</a></li>
<li>还有一些找不到了。。。。。</li>
</ul>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-09-06T08:46:12.941Z" itemprop="dateUpdated">2019-09-06 16:46:12</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2019/09/06/WhatHappensWhenYouTypeURLIntoYourBrowserAndPressEnter/" target="_blank" rel="external">https://tao-lol.top/2019/09/06/WhatHappensWhenYouTypeURLIntoYourBrowserAndPressEnter/</a>
        
    </div>
    <footer>
        <a href="https://tao-lol.top">
            <img src="/img/avatar.jpg" alt="濤">
            濤
        </a>
    </footer>
</blockquote>

        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://tao-lol.top/2019/09/06/WhatHappensWhenYouTypeURLIntoYourBrowserAndPressEnter/&title=《在浏览器输入 URL 回车之后发生了什么》 — Blog&pic=https://tao-lol.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://tao-lol.top/2019/09/06/WhatHappensWhenYouTypeURLIntoYourBrowserAndPressEnter/&title=《在浏览器输入 URL 回车之后发生了什么》 — Blog&source=
https://4ark.me/post/b6c7c0a2.html
" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/11/10/Pictures/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">图册</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/09/05/BehavioralDesignPatterns/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">行为型(Behavioral) 设计模式</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#大致流程"><span class="post-toc-number">2.</span> <span class="post-toc-text">大致流程</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一、URL-解析"><span class="post-toc-number"></span> <span class="post-toc-text">一、URL 解析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#地址解析："><span class="post-toc-number">1.</span> <span class="post-toc-text">地址解析：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#HSTS"><span class="post-toc-number">2.</span> <span class="post-toc-text">HSTS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#其他操作"><span class="post-toc-number">3.</span> <span class="post-toc-text">其他操作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#检查缓存"><span class="post-toc-number">4.</span> <span class="post-toc-text">检查缓存</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#二、DNS-查询"><span class="post-toc-number"></span> <span class="post-toc-text">二、DNS 查询</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基本步骤"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本步骤</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-浏览器缓存"><span class="post-toc-number">2.</span> <span class="post-toc-text">1. 浏览器缓存</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-操作系统缓存"><span class="post-toc-number">3.</span> <span class="post-toc-text">2. 操作系统缓存</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-路由器缓存"><span class="post-toc-number">4.</span> <span class="post-toc-text">3. 路由器缓存</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-ISP-DNS-缓存"><span class="post-toc-number">5.</span> <span class="post-toc-text">4. ISP DNS 缓存</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#根域名服务器查询"><span class="post-toc-number">6.</span> <span class="post-toc-text">根域名服务器查询</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#需要注意的点"><span class="post-toc-number">7.</span> <span class="post-toc-text">需要注意的点</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#三、TCP-连接"><span class="post-toc-number"></span> <span class="post-toc-text">三、TCP 连接</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-应用层：发送-HTTP-请求"><span class="post-toc-number">1.</span> <span class="post-toc-text">1. 应用层：发送 HTTP 请求</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-传输层：TCP-传输报文"><span class="post-toc-number">2.</span> <span class="post-toc-text">2. 传输层：TCP 传输报文</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-网络层：IP协议查询Mac地址"><span class="post-toc-number">3.</span> <span class="post-toc-text">3. 网络层：IP协议查询Mac地址</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-链路层：以太网协议"><span class="post-toc-number">4.</span> <span class="post-toc-text">4. 链路层：以太网协议</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#以太网协议"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">以太网协议</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Mac-地址"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">Mac 地址</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#广播"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">广播</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#服务器接受请求"><span class="post-toc-number">5.</span> <span class="post-toc-text">服务器接受请求</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#四、服务器处理请求"><span class="post-toc-number"></span> <span class="post-toc-text">四、服务器处理请求</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#大致流程-1"><span class="post-toc-number">1.</span> <span class="post-toc-text">大致流程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#HTTPD"><span class="post-toc-number">2.</span> <span class="post-toc-text">HTTPD</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#处理请求"><span class="post-toc-number">3.</span> <span class="post-toc-text">处理请求</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#重定向"><span class="post-toc-number">4.</span> <span class="post-toc-text">重定向</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#URL-重写"><span class="post-toc-number">5.</span> <span class="post-toc-text">URL 重写</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#五、浏览器接受响应"><span class="post-toc-number"></span> <span class="post-toc-text">五、浏览器接受响应</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#六、渲染页面"><span class="post-toc-number"></span> <span class="post-toc-text">六、渲染页面</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#浏览器内核"><span class="post-toc-number">0.1.</span> <span class="post-toc-text">浏览器内核</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基本流程"><span class="post-toc-number">1.</span> <span class="post-toc-text">基本流程</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-HTML-解析"><span class="post-toc-number">2.</span> <span class="post-toc-text">1. HTML 解析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-解码（encoding）"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1. 解码（encoding）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-预解析（pre-parsing）"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2. 预解析（pre-parsing）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-符号化（Tokenization）"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3. 符号化（Tokenization）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-构建树（tree-construction）"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4. 构建树（tree construction）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#浏览器容错进制"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">浏览器容错进制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#事件"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">事件</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-CSS-解析"><span class="post-toc-number">3.</span> <span class="post-toc-text">2. CSS 解析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CSS-匹配规则"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">CSS 匹配规则</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-渲染树"><span class="post-toc-number">4.</span> <span class="post-toc-text">3. 渲染树</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#计算"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">计算</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#级联"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">级联</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#渲染阻塞"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">渲染阻塞</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-布局与绘制"><span class="post-toc-number">5.</span> <span class="post-toc-text">4. 布局与绘制</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5-合并渲染层"><span class="post-toc-number">6.</span> <span class="post-toc-text">5. 合并渲染层</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6-回流与重绘"><span class="post-toc-number">7.</span> <span class="post-toc-text">6. 回流与重绘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#回流-reflow"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">回流(reflow)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#重绘-repaint"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">重绘(repaint)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7-JavaScript-编译执行"><span class="post-toc-number">8.</span> <span class="post-toc-text">7. JavaScript 编译执行</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#大致流程-2"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">大致流程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-词法分析"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">1. 词法分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-预编译"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">2. 预编译</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#创建执行上下文"><span class="post-toc-number">8.3.1.</span> <span class="post-toc-text">创建执行上下文</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-执行"><span class="post-toc-number">8.4.</span> <span class="post-toc-text">3. 执行</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#JS-线程"><span class="post-toc-number">8.4.1.</span> <span class="post-toc-text">JS 线程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#宏任务"><span class="post-toc-number">8.4.2.</span> <span class="post-toc-text">宏任务</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#微任务"><span class="post-toc-number">8.4.3.</span> <span class="post-toc-text">微任务</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#代码例子"><span class="post-toc-number">8.4.4.</span> <span class="post-toc-text">代码例子</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考文档"><span class="post-toc-number"></span> <span class="post-toc-text">参考文档</span></a>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://tao-lol.top" target="_blank">Home</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/hexojs/hexo" target="_blank">Hexo</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">Mellow</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                濤 &copy; 2018 - 2019
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://tao-lol.top/2019/09/06/WhatHappensWhenYouTypeURLIntoYourBrowserAndPressEnter/&title=《在浏览器输入 URL 回车之后发生了什么》 — Blog&pic=https://tao-lol.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://tao-lol.top/2019/09/06/WhatHappensWhenYouTypeURLIntoYourBrowserAndPressEnter/&title=《在浏览器输入 URL 回车之后发生了什么》 — Blog&source=
https://4ark.me/post/b6c7c0a2.html
" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADNklEQVR42u3aQW7jMBAEwPz/097rLrKSukkZsMalU2A4NIs6DKaHPz/x8/r1/P35728erXD++flqv3/9fOUbHmxsbOyHsF+nz9FPJp8c/UpyoPkBHe3hYmVsbGzscey1n0lqxFp5y4812Rs2NjY2drvd83KS8JLylrRG2NjY2Nh3RT9twTsvYG1xxcbGxv4GdhIqrW16DbOf59+WpWFjY2N/PHuttHzm32+Zb2NjY2N/MPtVPu2abTCUjIrb4e5/VsbGxsYexG7bjPwI8qHsGnitTcLGxsaex84HscnFmpaRj3jbi0EXO8fGxsYexM43sd+E5O1EvvJaW4KNjY09iZ2XkHaYmp96Gz8lBawoXdjY2Ngj2PstR7vC2oB5Z9x7mKJhY2NjD2LvhO/vKHjtrhL2P60INjY29mh2O0DNS9Q7Qqu6fGJjY2OPY+elpb12sxMq5ReG6sYJGxsbexw7iX7uipySCz152bu5bmNjY2M/kJ0z2lw9QbblrY2TLg4XGxsbexC7HbK2ZSm/BtQ2P2svCRsbG3see62ErB1KGxK1MVMRSGFjY2MPZa/F7vmmz9uG9viSluaiA8PGxsYewW4jmzbWSTDJygng5q4LGxsb+yHsvMy049W3XJ2Mrw1dFDNsbGzscey1ktDG/Xe1Ikk5jEIlbGxs7Iezk020AVPbWuQHsVOusLGxsaey74pyzhuPnWKzf/PoIlTCxsbGHsFeGwPstCj5EeyEWdHQFxsbG3sQe+e6zM64tw2e1oYQ2NjY2LPZ7fC1HSe0zcn+tZ5kVIyNjY09id3+Q15m8k3vtxb5eBgbGxt7HjuP3dsttpn8WguUj5+xsbGxv4Ed/UMc6LQFr22H8oAJGxsb+9vYbZHYYefj3vY13JClYWNjY388+1U+ebORfycP+tvXcLgTbGxs7EHstQKQb64d5b67Xanx2NjY2A9hJ0UrKWD7LcdavJUXWmxsbOzZ7KQxWAt38k2v7Sc/YmxsbGzspJjtdDz5sOGGl4SNjY2NvTGmPW829ktXVD6xsbGxx7GTUGkt0GlJdx3QbVkaNjY29sezd5qE/ICS0tJeuMlJ+a6wsbGxH8X+AxGZupY7vQ2cAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.4"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.4"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.4"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>







    
</body>
</html>
