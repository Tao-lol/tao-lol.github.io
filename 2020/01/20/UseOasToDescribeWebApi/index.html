<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>使用 OAS（OpenAPI 标准）来描述 Web API | Blog | tao-lol</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="Web">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.4.4">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	false,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">濤</h5>
          <a href="mailto:tao-lol@qq.com" title="tao-lol@qq.com" class="mail">
            
              <span>t</span>
            
              <span>a</span>
            
              <span>o</span>
            
              <span>-</span>
            
              <span>l</span>
            
              <span>o</span>
            
              <span>l</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/Tao-lol" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>使用 OAS（OpenAPI 标准）来描述 Web API</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">使用 OAS（OpenAPI 标准）来描述 Web API</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-01-20T08:45:24.000Z" itemprop="datePublished" class="page-time">
  2020-01-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/">编程</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-UseOasToDescribeWebApi"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">使用 OAS（OpenAPI 标准）来描述 Web API</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-01-20 16:45:24" datetime="2020-01-20T08:45:24.000Z"  itemprop="datePublished">2020-01-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/">编程</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <blockquote>
<p><a href="https://www.cnblogs.com/cgzl/p/12217617.html" target="_blank" rel="noopener">https://www.cnblogs.com/cgzl/p/12217617.html</a></p>
</blockquote>
<a id="more"></a>

<p>&emsp;&emsp;无论哪种类型的 Web API 都可能需要给其他开发者使用，所以 API 的开发者体验是很重要的。API 的开发者体验，简写为 API DX（Developer Experience），它包含很多东西。例如如何使用 API、文档、技术支持等等，但是最重要的还是 API 的设计。如果 API 设计的不好，那么使用该 API 构建的软件就需要增加在时间、人力、金钱等方面的投入。有时候 API 会被错用，甚至带来毁灭性后果。最后抱怨该 API 的用户越来越多，慢慢地，客户就会停止使用该 API。<br>&emsp;&emsp;API 的目的是让人们可以简单的使用它来达到自己的目的。目前行业内有很多 API 风格，例如：REST、gRPC、GraphQL、SOAP、RPC 等等。但是每个风格都遵循一些基本的设计原则。</p>
<h1 id="用户就是上帝，为用户设计-API"><a href="#用户就是上帝，为用户设计-API" class="headerlink" title="用户就是上帝，为用户设计 API"></a>用户就是上帝，为用户设计 API</h1><p>&emsp;&emsp;和构建任何东西一样，你需要一个计划，你需要在真正做之前来决定你想要的是什么。API 设计也是一样的。<br>&emsp;&emsp;API 并不是用来盲目地暴露一些数据或业务处理能力。它就像我们每天使用的任何形式的接口一样，例如微波炉的操作按钮，是来帮助用户完成他们的目标的。所以需要从用户的视角来决定一个 API 的设计目标。在整个设计过程中，必须牢记以用户的视角去设计，如果以开发者的角度去设计，那么问题就大了。<br>&emsp;&emsp;如果以开发者的视角去设计 API，那么通常的后果是开发出的 API 会很注重功能实现的过程和原理，而不是用户如何能简单平滑地使用这个 API 来达到他们的目的。所以一定要注重用户的需求，而不要让内部实现细节、原理什么的来骚扰用户。最后再次强调，要设计出让用户容易理解和容易使用的 API。<br>&emsp;&emsp;所以 API 就是用户看到的，它表示出用户能使用它做什么。API 的实现细节，也就是如果完成的该功能的细节，需要对用户隐藏。</p>
<h1 id="识别-API-的目标"><a href="#识别-API-的目标" class="headerlink" title="识别 API 的目标"></a>识别 API 的目标</h1><p>&emsp;&emsp;记住首先考虑用户的感受之后，下面就需要考虑用户能拿它来做什么了，也就是识别 API 的目标。</p>
<p>&emsp;&emsp;识别 API 的目标，最基本的要对以下方面有深刻、精准的认识：</p>
<ol>
<li>Who，谁可以使用这个API？ </li>
<li>What，用户拿这个API能做什么事？  </li>
<li>How，用户如何做这件事？ </li>
<li>What need，用户想要做这件事的话还需要什么？ </li>
<li>What return，用户会得到什么？ </li>
</ol>
<p>&emsp;&emsp;1 就是指 API 的用户，4、5 分别表示输入输出。  </p>
<h2 id="针对-2、3-解释一下"><a href="#针对-2、3-解释一下" class="headerlink" title="针对 2、3 解释一下"></a>针对 2、3 解释一下</h2><p>&emsp;&emsp;通常针对 2. What（用户拿 API 能做什么）可以导致（分解）多个 3. How（多个步骤），这样的话每个步骤就是一个 API 的目标。<br>&emsp;&emsp;比如说，用户想去淘宝买一个商品，那么怎么买？首先需要把商品添加到购物车，然后再结账。那么这个 API 就应该有两个目标：添加商品到购物车 以及 结账。<br>&emsp;&emsp;如果不这样分解到话，通常设计出的 API 会缺失一些目标。 </p>
<h2 id="针对1，也解释一下"><a href="#针对1，也解释一下" class="headerlink" title="针对1，也解释一下"></a>针对1，也解释一下</h2><p>&emsp;&emsp;首先应该识别出不同种类的用户，这里的用户可能是人，也可能是其他的程序。通常通过检查输入和输出就可以识别出用户。 </p>
<p>&emsp;&emsp;总结一下就 6 个方面： </p>
<ul>
<li>用户 </li>
<li>能做什么 </li>
<li>如何做 - 分解步骤 </li>
<li>输入 </li>
<li>输出 </li>
<li>目标 </li>
</ul>
<h1 id="避免从开发者角度设计-API"><a href="#避免从开发者角度设计-API" class="headerlink" title="避免从开发者角度设计 API"></a>避免从开发者角度设计 API</h1><p>&emsp;&emsp;这部分包含几个方面，包括： </p>
<ul>
<li>开发者所在公司的组织结构（参考康威定律）；</li>
<li>数据，例如数据使用了开发者所在公司内部的一些专有术语，或者干脆把内部数据库模型暴露了出来；</li>
<li>不要暴露实现细节，避免受到业务逻辑实现细节的影响；</li>
<li>避免受到软件架构的影响，比如说在开发者公司内部查询产品名称和产品价格是两个 API，那么给用户使用的 API 必须整合一下，不能让用户分两步查询。 </li>
</ul>
<p>&emsp;&emsp;最重要的还是要时刻牢记，你所设计的这些东西都是用户真正需要的吗？ </p>
<p>&emsp;&emsp;下面切入正题： </p>
<h1 id="使用-API-描述格式来描述-API"><a href="#使用-API-描述格式来描述-API" class="headerlink" title="使用 API 描述格式来描述 API"></a>使用 API 描述格式来描述 API</h1><p>&emsp;&emsp;这里我以 RESTful 风格的 API 为例。想要了解使用 ASP.NET Core 3.x 构建 RESTful API，这里有一个教程：<a href="https://www.bilibili.com/video/av77957694/" target="_blank" rel="noopener">https://www.bilibili.com/video/av77957694/</a> 。</p>
<p>&emsp;&emsp;很多人使用 Excel 或者纸和笔来进行 API 的设计工作。但是如果想要在设计阶段精准描述一个 API，尤其是它的数据，那么最好使用一个结构化的工具，例如 API 描述格式。<br>&emsp;&emsp;API 描述格式会为 API 提供一个标准化的描述，并且它很像代码。它的优势主要有：</p>
<ul>
<li>有助于在项目团队中共享设计 </li>
<li>了解这种格式的人或者工具可以很简单的理解它。 </li>
</ul>
<p>&emsp;&emsp;针对 REST 而言，OpenAPI Specification（OAS）就是一个非常流行的 API 描述格式规范。 </p>
<h2 id="OAS"><a href="#OAS" class="headerlink" title="OAS"></a>OAS</h2><p>&emsp;&emsp;API 描述格式是一种数据格式，它的目标就是描述 API。<br>&emsp;&emsp;而 OAS（OpenAPI Specification）是一个与编程语言无关的 REST API 描述格式。它是由 OAI（OpenAPI Initiative）所提倡的。OAI 是 Linux 基金会下面的一个组织，专注于提供与供应商无关的描述格式。而 OAS 则是社区驱动的一种格式，任何人都可以做贡献。 </p>
<h2 id="OAS-vs-Swagger"><a href="#OAS-vs-Swagger" class="headerlink" title="OAS vs Swagger"></a>OAS vs Swagger</h2><p>&emsp;&emsp;OAS 原来叫 Swagger Specification，2015 年 11 月这个格式被贡献给了 OAI，并在 2016 年 1 月更名为 OpenAPI Specification。Swagger 规范最后的 2.0 版本就变成了 OpenAPI 2.0。目前最新的 OAS 应该是 3.0 大版本 </p>
<h2 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h2><p>&emsp;&emsp;OAS 文档可以使用 YAML 或 JSON 格式，我使用 YAML。 </p>
<h2 id="像写代码一样描述-API"><a href="#像写代码一样描述-API" class="headerlink" title="像写代码一样描述 API"></a>像写代码一样描述 API</h2><p>&emsp;&emsp;OAS 文档就是一个文本文件，可以纳入版本控制系统，例如 Git 等。所以在设计迭代的时候很容易进行版本管理和变化追踪。 </p>
<h2 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h2><p>&emsp;&emsp;OAS 有一个在线的专用编辑器：<a href="http://editor.swagger.io/" target="_blank" rel="noopener">http://editor.swagger.io/</a> 。</p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="1.png" title="" data-fancybox="images"><img src="1.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;左边是代码编辑区域，右边是渲染结果。 </p>
<p>&emsp;&emsp;但是我更习惯于本地编辑器，我使用 VSCode，并安装 Swagger Viewer 和 openapi-lint 两个插件。 </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="2.png" title="" data-fancybox="images"><img src="2.png" alt title class></a>
                <p></p>
            </figure>

<h2 id="共享-API-描述，-对-API-进行文档记录"><a href="#共享-API-描述，-对-API-进行文档记录" class="headerlink" title="共享 API 描述， 对 API 进行文档记录"></a>共享 API 描述， 对 API 进行文档记录</h2><p>&emsp;&emsp;OAS 文档可以用来生成 API 对引用文档，这个引用文档可以展示出所有可用的资源以及相应的操作。通常我会使用 Swagger UI，它就是上图右侧的部分。 </p>
<h2 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h2><p>&emsp;&emsp;使用 API 描述格式进行描述的 API，其代码也可以部分生成。通常是一个代码骨架。 </p>
<h2 id="什么时候使用-API-描述格式"><a href="#什么时候使用-API-描述格式" class="headerlink" title="什么时候使用 API 描述格式"></a>什么时候使用 API 描述格式</h2><p>&emsp;&emsp;肯定是在设计接口如何表达 API 目标和概念，以及数据的时候。 </p>
<h1 id="使用-OAS-来描述-REST-API-的资源以及-Action"><a href="#使用-OAS-来描述-REST-API-的资源以及-Action" class="headerlink" title="使用 OAS 来描述 REST API 的资源以及 Action"></a>使用 OAS 来描述 REST API 的资源以及 Action</h1><h2 id="创建-OAS-文档"><a href="#创建-OAS-文档" class="headerlink" title="创建 OAS 文档"></a>创建 OAS 文档</h2><p>&emsp;&emsp;建立一个 products.yaml 文件。<br>&emsp;&emsp;然后在里面输入 api 或 open 等字符串，会出现两个提示选项： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="3.png" title="" data-fancybox="images"><img src="3.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;先选择下面那个选项，其结果是： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="4.png" title="" data-fancybox="images"><img src="4.png" alt title class></a>
                <p></p>
            </figure>

<ul>
<li>第 1 行是 Open API 的版本 </li>
<li>第 4 行<code>info</code>的<code>version</code>是指 API 的版本，而<code>info</code>这个版本必须使用双引号<code>&quot;&quot;</code>括起来，否则 OAS 解析器会把它当成数字，从而导致文档验证失败（因为它的类型应该是字符串）。 </li>
<li>第 5 行<code>paths</code>，<code>paths</code>属性应该包含该 API 可用的资源。这里面使用<code>{}</code>仅仅是为了让文档验证通过，因为我目前还没有写什么内容。在 YAML 里，<code>{}</code>表示一个空的对象，而非空的对象则不需要这对大括号。 </li>
</ul>
<h2 id="描述资源"><a href="#描述资源" class="headerlink" title="描述资源"></a>描述资源</h2><p>&emsp;&emsp;为了描述 products 这个资源，就需要填写<code>paths</code>属性： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="5.png" title="" data-fancybox="images"><img src="5.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;这里<code>description</code>属性不是强制的，但是它可以用来描述该资源。 </p>
<h2 id="描述资源的操作"><a href="#描述资源的操作" class="headerlink" title="描述资源的操作"></a>描述资源的操作</h2><p>&emsp;&emsp;OAS 文档里描述的资源肯定包含一些操作，否则文档就不合理。<br>&emsp;&emsp;看代码： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="6.png" title="" data-fancybox="images"><img src="6.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;我为<code>/products</code>这个资源添加了一个 GET Action（<code>get</code>属性），然后我对这个<code>get</code>也进行了描述。<br>&emsp;&emsp;<code>summary</code>相当于是对这个 Action 的一个概括性描述，而<code>description</code>则能提供更详细的描述信息。<br>&emsp;&emsp;这里<code>description</code>是支持多行文本的，但是在 YAML 里面要想支持多行文本，那么 <em>string</em> 属性必须以<code>|</code>管道符 开头。<br>&emsp;&emsp;注意，这里第 1 行<code>openapi</code>下面的波浪线表示文档验证失败。   </p>
<p>&emsp;&emsp;在 OAS 文档里，一个操作必须在<code>responses</code>属性里提供至少一个响应： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="7.png" title="" data-fancybox="images"><img src="7.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;一个 Action 可能有多种响应结果，每种可能的响应结果都要在<code>responses</code>属性中描述。<br>&emsp;&emsp;每个响应都以<strong>状态码</strong>进行标识，并且必须包含一个<code>description</code>属性。<br>&emsp;&emsp;注意：状态码数字必须用双引号<code>&quot;&quot;</code>括起来，因为它的类型本应该是字符串，而这里的 200 是一个数字。 </p>
<p>&emsp;&emsp;下面我再添加一个 POST Action： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="8.png" title="" data-fancybox="images"><img src="8.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;这里还是针对<code>/products</code>这个资源，我就不过多解释了。 </p>
<h1 id="使用-OpenAPI-和-JSON-Schema-来描述-API-的数据"><a href="#使用-OpenAPI-和-JSON-Schema-来描述-API-的数据" class="headerlink" title="使用 OpenAPI 和 JSON Schema 来描述 API 的数据"></a>使用 OpenAPI 和 JSON Schema 来描述 API 的数据</h1><p>&emsp;&emsp;OAS 依赖于 JSON Schema 标准来对所有的数据（查询参数，body 参数，响应 body 等）进行描述。<br>&emsp;&emsp;注意，OAS 使用的其实是 JSON Schema 的一个子集，并不包含所有的 JSON Schema 特性， 并且还添加了一些 OAS 独有的特性到这个子集里。 </p>
<h2 id="描述查询参数"><a href="#描述查询参数" class="headerlink" title="描述查询参数"></a>描述查询参数</h2><p>&emsp;&emsp;如果我们的 get 操作里需要一些查询参数（查询字符串，Query String），那么可以使用<code>parameters</code>这个属性： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="9.png" title="" data-fancybox="images"><img src="9.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;这里<code>parameters</code>属性是一个集合或数组，每个集合元素使用<code>-</code>开头。 </p>
<p>&emsp;&emsp;为了描述一个参数，至少需要<code>name</code>，<code>in</code>和<code>schema</code>三个属性。在本例中，还包含<code>required</code>和<code>description</code>两个可选的属性。 </p>
<ul>
<li><code>in</code>表示参数的位置，这里值为 <em>query</em> ，表述它是查询字符串（Query String，例如<code>api/products?searchTerm=xxx</code>）。  </li>
<li><code>required</code>为 <em>false</em> 表示不是必填参数。<code>required</code>是可选的，如果没有写的话，那么它的值就是 <em>false</em> 。但是最好还是写上<code>required</code>属性。 </li>
<li>它的数据结构使用<code>schema</code>属性来表示，这里就是一个简单的字符串类型。但是它其实是一个 JSON schema，所以它可以是复杂的对象类型。 </li>
<li><code>description</code>属性也是可选的，但是最好还是写上吧，有个描述更好。 </li>
</ul>
<h2 id="使用-JSON-Schema-来描述数据"><a href="#使用-JSON-Schema-来描述数据" class="headerlink" title="使用 JSON Schema 来描述数据"></a>使用 JSON Schema 来描述数据</h2><p>&emsp;&emsp;假设一个对象有三个属性：编号（ <em>string</em> ），名称（ <em>string</em> ），价格（ <em>number</em> ）。那么使用 JSON Schema 来描述它就应该是这样的： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="10.png" title="" data-fancybox="images"><img src="10.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;还没完，我还必须指出属性是否是必填的，然后我再加上一个 remark 属性，它不是必填的： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="11.png" title="" data-fancybox="images"><img src="11.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;JSON Schema 通过<code>required</code>这个集合属性来表示哪些属性是必填的。 </p>
<p>&emsp;&emsp;此外， 我还可以在这里添加<code>description</code>和<code>example</code>（示例）属性： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="12.png" title="" data-fancybox="images"><img src="12.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;此外 JSON Schema 还支持 对象属性类型： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="13.png" title="" data-fancybox="images"><img src="13.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;JSON Schema 的东西比较多，具体可以查找一下官方文档。 </p>
<h2 id="描述响应"><a href="#描述响应" class="headerlink" title="描述响应"></a>描述响应</h2><p>&emsp;&emsp;在 OAS 文档里，操作响应返回的 body 里的数据是用<code>content</code>属性来表示： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="14.png" title="" data-fancybox="images"><img src="14.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;这里需要注意的就是该操作的结果是产品的数组，所以类型是 <em>array</em> ， 而 <em>array</em> 的<code>items</code>属性就包含着数组元素的 schema。 </p>
<h2 id="描述-body-参数"><a href="#描述-body-参数" class="headerlink" title="描述 body 参数"></a>描述 body 参数</h2><p>&emsp;&emsp;像 POST 这样的 Action，它的参数是在请求的 body 里面。<br>&emsp;&emsp;body 参数需要使用 requestBody 属性描述，看代码： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="15.png" title="" data-fancybox="images"><img src="15.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;这个 body 参数的内容也是使用 JSON Schema 来描述的。 </p>
<h2 id="描述路由参数"><a href="#描述路由参数" class="headerlink" title="描述路由参数"></a>描述路由参数</h2><p>&emsp;&emsp;像<code>api/products/{productId}</code>这样的 URI 里，productId 就是一个路由/路径参数。<br>&emsp;&emsp;它可以这样描述： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="16.png" title="" data-fancybox="images"><img src="16.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;这里面 name 的值必须和<code>{}</code>里面的值一样。<br>&emsp;&emsp;<code>in</code>的值为 <em>path</em> ，表示是路径参数。<br>&emsp;&emsp;路径参数是必填的，所以<code>required</code>为 <em>true</em> 。不然解析器会报错。 </p>
<h1 id="可复用组件"><a href="#可复用组件" class="headerlink" title="可复用组件"></a>可复用组件</h1><p>&emsp;&emsp;OAS 允许使用可复用的组件，例如 schema，参数，响应等等，使用它们的时候添加个引用就行。 </p>
<p>&emsp;&emsp;假设针对<code>/products</code>这个资源一共有两个操作：一个是返回一组产品，另一个返回单个产品。这时候返回产品的 JSON Schema 就可以使用一个可复用的 schema。<br>&emsp;&emsp;可复用的组件要放在<code>components</code>区域，它是 OAS 文档的一个根级属性。看例子： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="17.png" title="" data-fancybox="images"><img src="17.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;这里面，可复用的 schema 被定义在<code>schemas</code>属性里，每个可重用的 schema 的名字就是<code>schemas</code>的值，这里就是 product。它下就包含着可重用的组件：一个 JSON Schema。 </p>
<h2 id="引用定义好的-schema"><a href="#引用定义好的-schema" class="headerlink" title="引用定义好的 schema"></a>引用定义好的 schema</h2><p>&emsp;&emsp;引用定义好的 schema 需要使用到 JSON 引用。JSON 引用这个属性的名字是<code>$ref</code>，它的值是一个 URL。这个 URL 可指向本文档内部甚至外部的组件。这里我只引用文档内部的组件。 </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="18.png" title="" data-fancybox="images"><img src="18.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;而针对那个 get Action 的返回结果（数组类型），需要把 JSON 引用放在 <em>array</em> 的<code>items</code>属性里。 </p>
<h2 id="可复用参数"><a href="#可复用参数" class="headerlink" title="可复用参数"></a>可复用参数</h2><p>&emsp;&emsp;直接看代码： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="19.png" title="" data-fancybox="images"><img src="19.png" alt title class></a>
                <p></p>
            </figure>

<p>&emsp;&emsp;和可复用 schema 类似，可复用参数也放在<code>components</code>下面，它所在的区域是<code>parameters</code>。其引用方式也类似，就不过多介绍了。 </p>
<p>&emsp;&emsp;除了在 Action 级别引用可复用参数，在资源这个级别也可以这样做： </p>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="20.png" title="" data-fancybox="images"><img src="20.png" alt title class></a>
                <p></p>
            </figure>

<h1 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h1><figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="21.png" title="" data-fancybox="images"><img src="21.png" alt title class></a>
                <p></p>
            </figure>
<figure class="image-box">
                <a rel=使用 OAS（OpenAPI 标准）来描述 Web API href="22.png" title="" data-fancybox="images"><img src="22.png" alt title class></a>
                <p></p>
            </figure>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-01-22T07:44:24.659Z" itemprop="dateUpdated">2020-01-22 15:44:24</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2020/01/20/UseOasToDescribeWebApi/" target="_blank" rel="external">https://tao-lol.top/2020/01/20/UseOasToDescribeWebApi/</a>
        
    </div>
    <footer>
        <a href="https://tao-lol.top">
            <img src="/img/avatar.jpg" alt="濤">
            濤
        </a>
    </footer>
</blockquote>

        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://tao-lol.top/2020/01/20/UseOasToDescribeWebApi/&title=《使用 OAS（OpenAPI 标准）来描述 Web API》 — Blog&pic=https://tao-lol.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://tao-lol.top/2020/01/20/UseOasToDescribeWebApi/&title=《使用 OAS（OpenAPI 标准）来描述 Web API》 — Blog&source=
https://www.cnblogs.com/cgzl/p/12217617.html
" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/01/20/UsingSerilogAspNetCoreInAspNetCore3/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">在 ASP.NET Core 3.0 中使用 Serilog.AspNetCore</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/01/20/UseJwtInAspNetCore/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">ASP.Net Core 3.1 中使用 JWT 认证</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#用户就是上帝，为用户设计-API"><span class="post-toc-number">1.</span> <span class="post-toc-text">用户就是上帝，为用户设计 API</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#识别-API-的目标"><span class="post-toc-number">2.</span> <span class="post-toc-text">识别 API 的目标</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#针对-2、3-解释一下"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">针对 2、3 解释一下</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#针对1，也解释一下"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">针对1，也解释一下</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#避免从开发者角度设计-API"><span class="post-toc-number">3.</span> <span class="post-toc-text">避免从开发者角度设计 API</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#使用-API-描述格式来描述-API"><span class="post-toc-number">4.</span> <span class="post-toc-text">使用 API 描述格式来描述 API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OAS"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">OAS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OAS-vs-Swagger"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">OAS vs Swagger</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#YAML"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">YAML</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#像写代码一样描述-API"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">像写代码一样描述 API</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#编辑器"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">编辑器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#共享-API-描述，-对-API-进行文档记录"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">共享 API 描述， 对 API 进行文档记录</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#生成代码"><span class="post-toc-number">4.7.</span> <span class="post-toc-text">生成代码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#什么时候使用-API-描述格式"><span class="post-toc-number">4.8.</span> <span class="post-toc-text">什么时候使用 API 描述格式</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#使用-OAS-来描述-REST-API-的资源以及-Action"><span class="post-toc-number">5.</span> <span class="post-toc-text">使用 OAS 来描述 REST API 的资源以及 Action</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建-OAS-文档"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">创建 OAS 文档</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#描述资源"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">描述资源</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#描述资源的操作"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">描述资源的操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#使用-OpenAPI-和-JSON-Schema-来描述-API-的数据"><span class="post-toc-number">6.</span> <span class="post-toc-text">使用 OpenAPI 和 JSON Schema 来描述 API 的数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#描述查询参数"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">描述查询参数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用-JSON-Schema-来描述数据"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">使用 JSON Schema 来描述数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#描述响应"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">描述响应</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#描述-body-参数"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">描述 body 参数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#描述路由参数"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">描述路由参数</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#可复用组件"><span class="post-toc-number">7.</span> <span class="post-toc-text">可复用组件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#引用定义好的-schema"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">引用定义好的 schema</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#可复用参数"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">可复用参数</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#预览"><span class="post-toc-number">8.</span> <span class="post-toc-text">预览</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://tao-lol.top" target="_blank">Home</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/hexojs/hexo" target="_blank">Hexo</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">Mellow</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                濤 &copy; 2018 - 2020
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://tao-lol.top/2020/01/20/UseOasToDescribeWebApi/&title=《使用 OAS（OpenAPI 标准）来描述 Web API》 — Blog&pic=https://tao-lol.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://tao-lol.top/2020/01/20/UseOasToDescribeWebApi/&title=《使用 OAS（OpenAPI 标准）来描述 Web API》 — Blog&source=
https://www.cnblogs.com/cgzl/p/12217617.html
" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3aQY7DIAwF0Nz/0p3tjFTot0lHCjxWVZQEXhcO2L6ueLymY37/7yujt42eunlgYGA8lpEsscqYY5Ir5XkxMDAOYIwWMf/dm3j0huTO4XUMDAyMYLuW35NsKzEwMDC+EXCrh9LqNhEDAwMj38wlR9x845j8ZTefxTEwMB7IyLPu///7K/UNDAyMRzFexTHfnPXKADesCgMDY2vGepos4a0E7rw4ioGBsSujl+5P0mfVY+o8HH+4goGBcQwjT/33tn15q1leznwTcDEwMLZmJEXE+WTVp6pFhfI3AQMDYwtGtUzYKzTmDRN5m8XwLI6BgXEkIz+O5mG9ulksfD0wMDCOYUT1hIXr+fuTpzAwME5gJIXG6pYxP9DmjRc5GwMDYz/GSgvFfPs4n77XdjZcDwYGxgGMagBdCax3HYMxMDBOYOQprfye3ly9oP+n2QIDA2NTRhL+emE0b+boRU4MDAyMvLh4BaP3bLmAioGBsTWjesjMU2y9AF19JwYGxgmMJODmYTTfXPaWu/TdwMDAeDijFy5XmsmqYfdDag8DA+MARn6k7JUh7ypkRt8NDAyMjRiv4rirYJnwCmEXAwNja0Y+kiaJ9XRbL/GHgYFxAiMJsutJtJWS59V7DAMDYztGHviq+F5CrbpaDAwMjPJesjXLEhUDAwOj1RyWd6VVz9xv3oaBgXEAI9/kza9Xj7JJM0eU/sPAwNia8Y1cVjJ9UgRdb9HAwMB4OOMHlTNLqZl6kcsAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.4"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.4"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.4"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>







    
</body>
</html>
